#!/usr/bin/env python

import argparse
import os

from yt_spark_client import shell
from yt_spark_client.utils import default_token, default_discovery_dir, default_base_log_dir
from yt.wrapper import YPath

parser = argparse.ArgumentParser(description="Spark Submit")
parser.add_argument("--id", required=True)
parser.add_argument("--discovery-dir", required=False)
parser.add_argument("--log-dir", required=False)
parser.add_argument("--proxy", required=False)

args, unknown_args = parser.parse_known_args()

user = os.getenv("YT_USER") or os.getenv("USER")
proxy = args.proxy or os.getenv("YT_PROXY")
discovery_dir = args.discovery_dir or default_discovery_dir(user)
log_dir = args.log_dir or default_base_log_dir(discovery_dir).join(args.id)

shell(args.id, discovery_dir, log_dir, proxy, user, default_token(), os.getenv("SPARK_HOME"), *unknown_args)
