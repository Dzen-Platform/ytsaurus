#!/usr/bin/env python

import argparse
import os

from ytspark import raw_submit, default_token, default_discovery_dir, default_base_log_dir

parser = argparse.ArgumentParser(description="Spark Submit")
parser.add_argument("--id", required=True)
parser.add_argument("--discovery-dir", required=False)
parser.add_argument("--log-dir", required=False)
parser.add_argument("--proxy", required=False)

args, unknown_args = parser.parse_known_args()

user = os.getenv("USER")
proxy = args.proxy or os.getenv("YT_PROXY")
discovery_dir = args.discovery_dir or default_discovery_dir()
log_dir = args.log_dir or "{}/{}".format(default_base_log_dir(discovery_dir), args.id)

raw_submit(args.id, discovery_dir, log_dir, proxy, user, default_token(), os.getenv("SPARK_HOME"), *unknown_args)
