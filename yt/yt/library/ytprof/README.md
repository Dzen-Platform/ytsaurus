# ytprof

## CPU профайлер

YTProf содержит реализацию CPU профайлера, похожую на `runtime/pprof` из golang.

Библиотека пишет профиль в протобуф формате pprof. Для просмотра профиля нужен доступ
к исполняемому файлу.

YTProf поддерживает теги. `TCpuProfilerTagGuard` кладёт тег в TLS треда, а профайлер
сохраняет этот тег в семпл. Теги позволяют фильтровать профиль в pprof с помощью команды
`tagfocus`. Например, можно положить в тег тип запроса или имя текущего пользователя.

### Известные ограничения

- Для работы нужно, чтобы код был собран с флагом `--build=profile`. Добавление этого
флага может просадить производительность, поэтому рекомендуется использовать его
вместе с флагом `--thinlto`.
- go tool pprof не поддерживает символизацию профиля, потому что он получился не из go программы.
Нужно использовать https://github.com/google/pprof.

## Memory Profiler

YTProf позволяет экспортировать профиль аллокатора из tcmalloc. Cама библиотека ytprof
не зависит от всего tcmalloc. ytprof можно слинковать с приложением, но memory профайлер
будет работать только если приложение слинковано с TCMALLOC.