---
vcsPath: yql/docs_yfm/docs/ru/yql-product/faq/performance.md
sourcePath: yql-product/faq/performance.md
---
# Производительность

## Почему так долго работает запрос с JOIN?

Все основные виды [JOIN](../syntax/join.md) (кроме SEMI/ONLY) строят декартово произведение строк по совпадающим значениям ключей. Если одно или несколько значений ключа является особенным, то по нему может оказаться большое число строк с каждой из сторон и, как следствие, гигантское декартово произведение. В большинстве случаев JOIN работает медленно именно из-за этого, а такие особые значение с прикладной точки зрения оказываются не так интересны и достаточно их исключить в WHERE.

Найти аномально часто встречающиеся значения можно с помощью двух запросов по каждой из таблиц с GROUP BY по тем же ключам, что и у JOIN, используя агрегатную функцию COUNT и убывающую сортировку по её результату. Ещё можно добавить LIMIT 100, чтобы отработало ещё быстрее.

Также бывают запросы, где на самом деле декартово произведение в JOIN не нужно, т.к. потом всё равно от значений тем или иным способом оставляют только уникальные значения. В этом случае стоит убрать дубли в подзапросе через [GROUP BY](../syntax/group_by.md) или [SELECT DISTINCT](../syntax/select.md#distinct) ещё до JOIN.
