package NYT.NRpcProxy.NProto;

import "yt/core/rpc/rpc.proto";

////////////////////////////////////////////////////////////////////////////////

message TCredentialsExt
{
    extend NRpc.NProto.TRequestHeader
    {
        optional TCredentialsExt credentials_ext = 110;
    }

    optional string userip = 1;
    optional string token = 2;
    optional string domain = 3;
    optional string sessionid = 4;
    optional string sslsessionid = 5;
}

////////////////////////////////////////////////////////////////////////////////

enum ERowsetKind
{
    SCHEMAFUL = 0;
    UNVERSIONED = 1;
    VERSIONED = 2;
}

// Specifies how to decode rowset data passed via attachments.
message TRowsetDescriptor
{
    // Currently, there is only one version. This field is reserved for future changes.
    optional int32 wire_format_version = 1 [default = 1];

    // Specifies, what kind of rows are encoded.
    optional ERowsetKind rowset_kind = 2 [default = UNVERSIONED];

    message TColumnDescriptor
    {
        optional string name = 1;
        optional int32 type = 2;
    }

    // Specifies column names and types.
    // May be omitted for unversioned rowset.
    // Must be present for schemaful rowset.
    // Must be present for versioned rowset.
    repeated TColumnDescriptor columns = 3;
}

////////////////////////////////////////////////////////////////////////////////

message TReqGetNode
{
    required string path = 1;
}

message TRspGetNode
{
    required bytes data = 1;
}

message TReqLookupRows
{
    required string path = 1;

    repeated string columns = 2;
    optional uint64 timestamp = 3 [default = 0x3fffffffffffff01];
    optional bool keep_missing_rows = 4 [default = true];

    required TRowsetDescriptor rowset_descriptor = 200;
}

message TRspLookupRows
{
    required TRowsetDescriptor rowset_descriptor = 200;
}

message TReqVersionedLookupRows
{
    required string path = 1;

    repeated string columns = 2;
    optional uint64 timestamp = 3 [default = 0x3fffffffffffff01];
    optional bool keep_missing_rows = 4 [default = true];

    required TRowsetDescriptor rowset_descriptor = 200;
}

message TRspVersionedLookupRows
{
    required TRowsetDescriptor rowset_descriptor = 200;
}

////////////////////////////////////////////////////////////////////////////////
