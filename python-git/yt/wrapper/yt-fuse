#!/usr/bin/env python

import yt.wrapper.cypress_fuse as cypress_fuse
from yt.packages.fuse import FUSE

from argparse import ArgumentParser

import sys

def mount_cypress(proxy, mountpoint):
    """Mount a Cypress."""
    cypress = cypress_fuse.Cypress(cypress_fuse.CachedYtClient(proxy=proxy))
    FUSE(
        cypress, mountpoint,
        raw_fi=True, nothreads=True, foreground=True
    )
    return 0


if __name__ == "__main__":
    parser = ArgumentParser(description="Mount a Cypress, an YT cluster metainformation tree")

    parser.add_argument("proxy", help="Proxy alias like \"aristotle.yt.yandex.net\" or just \"aristotle\".")
    parser.add_argument("mountpoint", help="Mountpoint directory like \"/mnt/aristotle\".")

    args = parser.parse_args()

    sys.exit(
        mount_cypress(args.proxy, args.mountpoint)
    )
